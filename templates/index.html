<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mass Effect Image Forge</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap');

        body {
            background-color: #0b0f16; /* –¢–µ–º–Ω—ã–π —Ñ–æ–Ω, –∫–∞–∫ –∫–æ—Å–º–æ—Å */
            color: #d1d8e0; /* –°–≤–µ—Ç–ª—ã–π —Ç–µ–∫—Å—Ç */
            font-family: 'Orbitron', sans-serif; /* –§—É—Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π —à—Ä–∏—Ñ—Ç */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            background-color: #1a1e27; /* –¢–µ–º–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
            border: 2px solid #007bff; /* –Ø—Ä–∫–∞—è —Å–∏–Ω—è—è —Ä–∞–º–∫–∞ */
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 0 20px rgba(0, 123, 255, 0.5); /* –°–∏–Ω–µ–µ —Å–≤–µ—á–µ–Ω–∏–µ */
            width: 100%;
            max-width: 600px;
            text-align: center;
        }

        h1 {
            color: #007bff;
            text-shadow: 0 0 8px rgba(0, 123, 255, 0.7);
            margin-bottom: 30px;
            font-size: 2.2em;
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #a0c0e0;
        }

        input[type="text"],
        select {
            background-color: #0f121a;
            color: #d1d8e0;
            border: 1px solid #0056b3;
            border-radius: 5px;
            padding: 12px;
            font-size: 1em;
            width: calc(100% - 24px); /* –£—á–∏—Ç—ã–≤–∞–µ–º padding */
            box-sizing: border-box;
            font-family: 'Orbitron', sans-serif;
        }

        input[type="file"] {
            background-color: #0f121a;
            color: #d1d8e0;
            border: 1px solid #0056b3;
            border-radius: 5px;
            padding: 12px;
            font-size: 1em;
            width: calc(100% - 24px);
            box-sizing: border-box;
            font-family: 'Orbitron', sans-serif;
        }

        button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 15px 25px;
            font-size: 1.2em;
            font-family: 'Orbitron', sans-serif;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.5);
        }

        button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }

        .result-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px dashed #0056b3;
            text-align: center;
        }

        .result-section img {
            max-width: 100%;
            height: auto;
            border: 3px solid #007bff;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 123, 255, 0.7);
        }

        .result-section p {
            word-break: break-all; /* –î–ª—è –¥–ª–∏–Ω–Ω—ã—Ö URL */
            color: #a0c0e0;
        }

        .error-message {
            color: #dc3545; /* –ö—Ä–∞—Å–Ω—ã–π –¥–ª—è –æ—à–∏–±–æ–∫, –∫–∞–∫ —Å–∏–≥–Ω–∞–ª —Ç—Ä–µ–≤–æ–≥–∏ */
            background-color: #3b0f14;
            border: 1px solid #dc3545;
            padding: 10px;
            border-radius: 5px;
            margin-top: 15px;
        }

        .image-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* 2 –∫–æ–ª–æ–Ω–∫–∏ */
            gap: 15px 20px; /* –û—Ç—Å—Ç—É–ø—ã –º–µ–∂–¥—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ */
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Mass Effect Image Forge üåå</h1>

        <form id="imageForm" action="/generate-images" method="post">
            <label for="prompt">–û–ø–∏—à–∏, —á—Ç–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ –∏–∑–æ–±—Ä–∞–∑–∏—Ç—å, –∫–æ–º–º–∞–Ω–¥–µ—Ä:</label>

            <textarea id="prompt" name="prompt" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ë—Ä–æ–Ω—è N7 –≤ —Å—Ç–∏–ª–µ –∫–∏–±–µ—Ä–ø–∞–Ω–∫"
                    onkeydown="return handleEnter(event)" oninput="updatePromptLength()"
                    style="resize: vertical; font-family: 'Orbitron', sans-serif; width: 100%;
                            padding: 12px; box-sizing: border-box; background-color: #0f121a; color: #d1d8e0;
                            border: 1px solid #0056b3; border-radius: 5px; font-size: 1em; display: block; height: 150px;">{{ prompt }}</textarea>
            <div style="text-align: right; color: #a0c0e0; font-size: 0.8em; margin-top: -10px;">
                –î–ª–∏–Ω–∞ –ø—Ä–æ–º–ø—Ç–∞: <span id="promptLength">0</span>
            </div>

            <button type="button" onclick="generateImages()">Deploy Mission! üöÄ</button>
            <div id="loadingIndicator" style="display:none; color: #a0c0e0; margin-top: 10px;">
                –ó–∞–ø—Ä–æ—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –±–æ—Ä—Ç–æ–≤—ã–º –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–º... –û–∂–∏–¥–∞–π—Ç–µ, –∫–æ–º–º–∞–Ω–¥–µ—Ä...
            </div>
        </form>

        <div class="result-section" {% if not image_urls %} style="display: none;" {% endif %}>
            <h2>–ü–æ–ª—É—á–µ–Ω—ã —Ñ–∞–π–ª—ã —Å –ù–æ—Ä–º–∞–Ω–¥–∏–∏:</h2>
            <div class="image-grid">
                {% for url in image_urls %}
                    <a href="{{ url }}" target="_blank">
                        <img src="{{ url }}" alt="–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
                    </a>
                {% endfor %}
            </div>
        </div>

        {% if error_message %}
            <div class="error-message">
                <h2>–í–Ω–∏–º–∞–Ω–∏–µ, –∫–æ–º–º–∞–Ω–¥–µ—Ä!</h2>
                <p>{{ error_message }}</p>
            </div>
        {% endif %}
    </div>

    <script>
        function handleEnter(event) {
            if (event.key === "Enter") {
                event.preventDefault();
                const textarea = document.getElementById("prompt");
                textarea.value += "\n";
                textarea.scrollTop = textarea.scrollHeight; // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –Ω–∏–∑—É
                updatePromptLength(); // –û–±–Ω–æ–≤–ª—è–µ–º –¥–ª–∏–Ω—É –ø—Ä–æ–º–ø—Ç–∞
                return false;
            }
            return true;
        }

        function updatePromptLength() {
            const textarea = document.getElementById("prompt");
            const length = textarea.value.length;
            document.getElementById("promptLength").innerText = length;
        }

        function generateImages() {
            const form = document.getElementById('imageForm');
            const formData = new FormData(form);
            const loadingIndicator = document.getElementById('loadingIndicator'); // –ü–æ–ª—É—á–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏

            loadingIndicator.style.display = 'block'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏

            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π URL –∏–∑ Flask
            const generateImagesEndpoint = "{{ generate_images_url }}"; // <--- –ò–∑–º–µ–Ω–µ–Ω–æ

            console.log(`Fetching from endpoint : ${generateImagesEndpoint}`); // <--- –î–æ–±–∞–≤–ª–µ–Ω–æ

            fetch(generateImagesEndpoint, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
                    document.querySelector('.error-message p').textContent = data.error;
                    document.querySelector('.error-message').style.display = 'block';
                    document.querySelector('.result-section').style.display = 'none';
                } else {
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                    const imageGrid = document.querySelector('.image-grid');
                    imageGrid.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ä—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

                    data.image_urls.forEach(url => {
                        const a = document.createElement('a');
                        a.href = url;
                        a.target = '_blank';

                        const img = document.createElement('img');
                        img.src = url;
                        img.alt = '–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ';

                        a.appendChild(img);
                        imageGrid.appendChild(a);
                    });

                    document.querySelector('.result-section').style.display = 'block';
                    document.querySelector('.error-message').style.display = 'none';
                }
            })
            .catch(error => {
                console.error('–û—à–∏–±–∫–∞:', error);
                document.querySelector('.error-message p').textContent = "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞.";
                document.querySelector('.error-message').style.display = 'block';
                document.querySelector('.result-section').style.display = 'none';
            })
            .finally(() => {
                loadingIndicator.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ
            });
        }

        window.onload = function() {
            updatePromptLength(); // –û–±–Ω–æ–≤–ª—è–µ–º –¥–ª–∏–Ω—É –ø—Ä–æ–º–ø—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        };
    </script>
</body>
</html>